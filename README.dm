# Система оценки риска ДТП по маршруту

## Описание задачи

В данном проекте необходимо разработать систему, способную оценивать риск возникновения ДТП на основе выбранного маршрута. Система предназначена для каршеринговой компании и должна выдавать предупреждения и рекомендации водителю, если риск превышает допустимый уровень.

Основная цель проекта — проверить возможность предсказания ДТП, опираясь на исторические данные одного из регионов. Ключевые моменты задачи:

- **Модель предсказания ДТП**  
  - Целевая переменная: `at_fault` (определяет виновника ДТП).
  - Отбор участников: анализируем только случаи, когда тип участника — автомобиль (`car`).
  - Отбор повреждений: учитывать ДТП, приведшие к любым значимым повреждениям, исключая тип повреждения `SCRATCH` (царапина).
  - Период анализа: данные за 2012 год.
  - Особое внимание уделяется учёту фактора возраста автомобиля.

- **Исследование факторов ДТП**  
  - Анализ данных с целью выявления основных факторов, влияющих на вероятность ДТП.
  - Ответы на вопросы:
    - Возможно ли создание адекватной системы оценки риска при выдаче авто?
    - Какие дополнительные факторы необходимо учитывать?
    - Требуется ли оснащение автомобиля датчиками или камерами?

## План работ

1. **Загрузка данных**
   - Подключение к базе данных с использованием предоставленных учетных данных.
   - Загрузка таблиц: `collisions`, `parties`, `vehicles`.

2. **Первичное исследование таблиц**
   - Проверка наличия данных во всех таблицах.
   - Сверка количества таблиц с условием задачи.
   - Определение общего ключа для связи таблиц (например, `CASE_ID`).

3. **Статистический анализ факторов ДТП**
   - **Анализ распределения аварий по месяцам**
     - Формирование SQL-запроса для получения данных о количестве ДТП по месяцам.
     - Построение графика распределения аварий.
     - Выводы по выявленным пиковым периодам.
   - **Формирование аналитических задач для коллег**
     - Составление не менее шести аналитических задач на основе таблиц `collisions` и `parties`.
       - Пример задач:
         - Анализ серьёзности повреждений транспортного средства в зависимости от состояния дороги.
         - Определение самых частых причин ДТП.
     - Детальное описание порядка решения для двух выбранных задач:
       - Создание SQL-запроса.
       - Построение графика.
       - Формулировка выводов.

4. **Создание модели оценки риска**
   - **Подготовка набора данных**
     - Отбор записей, где тип участника ДТП — `car`.
     - Исключение случаев с повреждениями типа `SCRATCH`.
     - Использование данных за 2012 год.
     - Формирование исходной таблицы посредством SQL-запроса.
   - **Отбор факторов для модели**
     - Анализ описания факторов и выбор тех, которые могут влиять на вероятность ДТП.
     - Обоснование выбора переменных (например, `party_type`, `party_sobriety` и др.).
   - **Статистическое исследование выбранных факторов**
     - Анализ распределения и взаимосвязей факторов.
     - При необходимости: категоризация, масштабирование данных, разделение выборки на обучающую и тестовую.

5. **Построение и сравнение моделей**
   - Разработка не менее трёх моделей с перебором гиперпараметров.
   - Выбор и обоснование метрики оценки модели, исходя из бизнес-требований.
   - Составление сравнительной таблицы для оценки качества моделей.

6. **Проверка лучшей модели в работе**
   - Построение матрицы ошибок для визуального анализа (график полноты и точности).
   - Анализ важности факторов, влияющих на вероятность ДТП.
   - Дополнительное исследование одного из ключевых факторов:
     - Построение графика зависимости выбранного фактора и целевой переменной.
     - Предложение мер по оснащению автомобиля (например, установка датчиков или камер) для учёта данного фактора.

7. **Общий вывод по модели**
   - Краткое описание лучшей модели.
   - Выводы о возможности создания адекватной системы оценки риска при выдаче автомобиля.
   - Рекомендации по сбору дополнительных факторов для дальнейшего улучшения модели.

## Инструкции по выполнению проекта

- Проект выполняется в **Jupyter Notebook**:
  - Код пишется в ячейках типа `code`.
  - Текстовые пояснения и описание шагов — в ячейках типа `markdown`.
- Необходимо учитывать комментарии ревьюера и дорабатывать проект до полного одобрения.
- Итоговая работа отправляется на проверку после выполнения всех доработок.

---


## Описание признаков

### Таблица: Collisions (Информация о происшествиях)

| **Описание**                                           | **Обозначение в таблице** | **Обозначение в датафрейме** | **Подробнее**                                                                                                                                                                               |
|--------------------------------------------------------|---------------------------|------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Идентификационный номер в базе данных                | `CASE_ID`                 | `case_id`                    | Уникальный номер для зарегистрированного происшествия.                                                                                                                                     |
| Дата происшествия                                     | `COLLISION_DATE`          | `collision_date`             | Дата ДТП в формате: Год/Месяц/День.                                                                                                                                                           |
| Время происшествия                                    | `COLLISION_TIME`          | `collision_time`             | Время ДТП в 24-часовом формате.                                                                                                                                                               |
| Место происшествия — перекрёсток или нет              | `INTERSECTION`            | `intersection`               | Значения:<br>• **Y** — Intersection (перекрёсток)<br>• **N** — Not Intersection (не перекрёсток)<br>• **--** — Not stated (не указано)                                          |
| Погода                                               | `WEATHER_1`               | `weather_1`                  | Значения:<br>• **A** — Clear (Ясно)<br>• **B** — Cloudy (Облачно)<br>• **C** — Raining (Дождь)<br>• **D** — Snowing (Снегопад)<br>• **E** — Fog (Туман)<br>• **F** — Other (Другое)<br>• **G** — Wind (Ветер)<br>• **-** — Not stated (Не указано) |
| Серьёзность происшествия                              | `COLLISION_DAMAGE`        | `collision_damage`           | Значения:<br>• **1** — FATAL (ТС не подлежит восстановлению)<br>• **2** — SEVERE DAMAGE (Серьёзный ремонт, большая часть под замену)<br>• **3** — MIDDLE DAMAGE (Средний ремонт)<br>• **4** — SMALL DAMAGE (Мелкий ремонт, замена отдельных элементов)<br>• **0** — SCRATCH (Царапина) |
| Основной фактор аварии                                | `PRIMARY_COLL_FACTOR`     | `primary_coll_factor`        | Значения:<br>• **A** — Code Violation (Нарушение ПДД)<br>• **B** — Other Improper Driving (Другое неправильное вождение)<br>• **C** — Other Than Driver (Кроме водителя)<br>• **D** — Unknown (Неизвестно)<br>• **E** — Fell Asleep (Заснул)<br>• **-** — Not stated (Не указано)         |
| Состояние дороги                                      | `ROAD_SURFACE`            | `road_surface`               | Значения:<br>• **A** — Dry (Сухая)<br>• **B** — Wet (Мокрая)<br>• **C** — Snowy or Icy (Заснеженная или обледенелая)<br>• **D** — Slippery (Скользкая, грязная, маслянистая)<br>• **-** — Not stated (Не указано)                     |
| Освещение                                            | `LIGHTING`                | `lighting`                 | Значения:<br>• **A** — Daylight (Дневной свет)<br>• **B** — Dusk-Dawn (Сумерки-Рассвет)<br>• **C** — Dark-Street Lights (Темно, с уличными фонарями)<br>• **D** — Dark-No Street Lights (Темно, без уличных фонарей)<br>• **E** — Dark-Street Lights Not Functioning (Не работают уличные фонари)<br>• **-** — Not stated (Не указано) |
| Номер географических районов                         | `COUNTY_CITY_LOCATION`    | `county_city_location`       | Числовое значение, обозначающее номер района, где произошло ДТП.                                                                                                                            |
| Названия географических районов                      | `COUNTY_LOCATION`         | `county_location`            | Список различных названий районов (категориальные данные).                                                                                                                                   |
| Направление движения                                 | `DIRECTION`               | `direction`                | Значения:<br>• **N** — North (Север)<br>• **E** — East (Восток)<br>• **S** — South (Юг)<br>• **W** — West (Запад)<br>• **-** или пустое значение — Not stated (Не указано)                                |
| Расстояние от главной дороги (в метрах)              | `DISTANCE`                | `distance`                 | Числовое значение расстояния от главной дороги до места происшествия.                                                                                                                       |
| Тип дороги                                           | `LOCATION_TYPE`           | `location_type`            | Значения:<br>• **H** — Highway (Шоссе)<br>• **I** — Intersection (Перекрёсток)<br>• **R** — Ramp (или Collector, рампа)<br>• **-** или пустое значение — Not stated (Не указано)                           |
| Количество участников                                | `PARTY_COUNT`             | `party_count`              | Числовое значение, отражающее общее число участников ДТП.                                                                                                                                     |
| Категория нарушения                                  | `PCF_VIOLATION_CATEGORY`  | `pcf_violation_category`   | Значения:<br>• **01** — Driving or Bicycling Under the Influence of Alcohol or Drug (Вождение или езда на велосипеде в состоянии опьянения)<br>• **02** — Impeding Traffic (Препятствие движению)<br>• **03** — Unsafe Speed (Превышение скорости)<br>• **04** — Following Too Closely (Опасное сближение)<br>• **05** — Wrong Side of Road (Неправильная сторона дороги)<br>• **06** — Improper Passing (Неправильное движение)<br>• **07** — Unsafe Lane Change (Небезопасная смена полосы)<br>• **08** — Improper Turning (Неправильный поворот)<br>• **09** — Automobile Right of Way (Автомобильное право проезда)<br>• **10** — Pedestrian Right of Way (Пешеходное право проезда)<br>• **11** — Pedestrian Violation (Нарушение пешеходами)<br>• **12** — Traffic Signals and Signs (Дорожные сигналы и знаки)<br>• **13** — Hazardous Parking (Неправильная парковка)<br>• **14** — Lights (Освещение)<br>• **15** — Brakes (Тормоза)<br>• **16** — Other Equipment (Другое оборудование)<br>• **17** — Other Hazardous Violation (Другие нарушения)<br>• **18** — Other Than Driver (или Pedestrian) (Кроме водителя или пешехода)<br>• **19** — Speeding (Скорость)<br>• **20** — Pedestrian dui (Нарушение пешехода)<br>• **21** — Unsafe Starting or Backing (Опасный старт)<br>• **22** — Other Improper Driving (Другое неправильное вождение)<br>• **23** — Pedestrian or “Other” Under the Influence of Alcohol or Drug (Пешеход или «Другой» в состоянии опьянения)<br>• **24** — Fell Asleep (Заснул)<br>• **00** — Unknown (Неизвестно)<br>• **-** — Not stated (Не указано) |
| Тип аварии                                           | `TYPE_OF_COLLISION`       | `type_of_collision`        | Значения:<br>• **A** — Head-On (Лоб в лоб)<br>• **B** — Sideswipe (Сторонний удар)<br>• **C** — Rear End (Столкновение сзади)<br>• **D** — Broadside (Боковой удар)<br>• **E** — Hit Object (Удар о препятствие)<br>• **F** — Overturned (Опрокинутый)<br>• **G** — Vehicle/Pedestrian (Транспортное средство/Пешеход)<br>• **H** — Other (Другое)<br>• **-** — Not stated (Не указано) |
| Дополнительные участники ДТП                         | `MOTOR_VEHICLE_INVOLVED_WITH` | `motor_vehicle_involved_with` | Категориальные данные, указывающие на тип другого участника или объекта, участвующего в ДТП (например, другой автомобиль, неподвижный объект, пешеход, велосипедист, животное, поезд и т.д.).      |
| Дорожное состояние                                   | `ROAD_CONDITION_1`        | `road_condition_1`         | Значения:<br>• **A** — Holes, Deep Ruts (Ямы, глубокая колея)<br>• **B** — Loose Material on Roadway (Сыпучий материал на проезжей части)<br>• **C** — Obstruction on Roadway (Препятствие на проезжей части)<br>• **D** — Construction or Repair Zone (Зона строительства или ремонта)<br>• **E** — Reduced Roadway Width (Уменьшенная ширина проезжей части)<br>• **F** — Flooded (Затоплено)<br>• **G** — Other (Другое)<br>• **H** — No Unusual Condition (Нет ничего необычного)<br>• **-** — Not stated (Не указано) |
| Устройство управления                                | `CONTROL_CONDITION_1`     | `control_condition_1`      | Значения:<br>• **A** — Functioning (Функционирует)<br>• **B** — Not Functioning (Не функционирует)<br>• **C** — Obscured (Затемнённый)<br>• **D** — None (Нет)<br>• **-** — Not stated (Не указано) |

---

### Таблица: Parties (Описание участников происшествия)

| **Описание**                                           | **Обозначение в таблице** | **Обозначение в датафрейме** | **Подробнее**                                                                                                                                                      |
|--------------------------------------------------------|---------------------------|------------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Идентификационный номер в базе данных                | `CASE_ID`                 | `case_id`                    | Уникальный номер для зарегистрированного происшествия.                                                                                                            |
| Номер участника происшествия                           | `PARTY_NUMBER`            | `party_number`               | Номер участника в пределах конкретного ДТП (от 1 до N в зависимости от количества участников).                                                                    |
| Тип участника происшествия                             | `PARTY_TYPE`              | `party_type`                 | Значения:<br>• **1** — Car (Автомобиль)<br>• **2** — Road bumper (Отбойник)<br>• **3** — Building (Строение)<br>• **4** — Road signs (Дорожные знаки)<br>• **5** — Other (Другое)<br>• **6** — Operator (Оператор)<br>• **-** — Not stated (Не указано) |
| Виновность участника                                   | `AT_FAULT`                | `at_fault`                   | Логическое значение (0/1), указывающее, является ли участник виновным в ДТП.                                                                                       |
| Сумма страховки (тыс. $)                               | `INSURANCE_PREMIUM`       | `insurance_premium`          | Числовое значение, представляющее сумму страховки участника в тысячах долларов.                                                                                    |
| Состояние участника (физическое/с учетом лекарств)     | `PARTY_DRUG_PHYSICAL`     | `party_drug_physical`        | Значения:<br>• **E** — Under Drug Influence (Под воздействием лекарств)<br>• **F** — Impairment — Physical (Ухудшение физического состояния)<br>• **G** — Impairment Unknown (Неизвестно ухудшение)<br>• **H** — Not Applicable (Не оценивался)<br>• **I** — Sleepy/Fatigued (Сонный/Усталый)<br>• **-** — Not stated (Не указано) |
| Трезвость участника                                    | `PARTY_SOBRIETY`          | `party_sobriety`             | Значения:<br>• **A** — Had Not Been Drinking (Не пил)<br>• **B** — Had Been Drinking, Under Influence (Пьяный, под влиянием)<br>• **C** — Had Been Drinking, Not Under Influence (Пьяный, но не под влиянием)<br>• **D** — Had Been Drinking, Impairment Unknown (Пьяный, степень ухудшения неизвестна)<br>• **G** — Impairment Unknown (Неизвестно ухудшение)<br>• **H** — Not Applicable (Не оценивался)<br>• **-** — Not stated (Не указано) |
| Наличие телефона в автомобиле                        | `CELLPHONE_IN_USE`        | `cellphone_in_use`           | Логическое значение (0/1), указывающее, использовался ли телефон во время движения (например, для разговора по громкой связи).                                         |

---

### Таблица: Vehicles (Описание автомобиля)

| **Описание**                                        | **Обозначение в таблице** | **Обозначение в датафрейме** | **Подробнее**                                                                          |
|-----------------------------------------------------|---------------------------|------------------------------|----------------------------------------------------------------------------------------|
| Индекс текущей таблицы                              | `ID`                      | `id`                         | Номер записи в таблице транспортных средств.                                           |
| Идентификационный номер в базе данных               | `CASE_ID`                 | `case_id`                    | Уникальный номер для зарегистрированного происшествия.                                  |
| Номер участника происшествия                        | `PARTY_NUMBER`            | `party_number`               | Номер участника ДТП, соответствующий записи в таблице участников.                        |
| Тип кузова                                          | `VEHICLE_TYPE`            | `vehicle_type`               | Категориальное значение, характеризующее тип транспортного средства (например, MINIVAN, COUPE и т.д.). |

---
```


